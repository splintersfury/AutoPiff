# AutoPiff exploit mapping
# Connects detection findings (AutoPiff categories, IOCTLance titles)
# to vulnerability classes, exploit primitives, and techniques.
# Techniques include Windows version applicability from KernelSight.

vuln_classes:

  buffer_overflow:
    autopiff_categories: [bounds_check, string_handling]
    autopiff_sinks: [memory_copy, string_copy]
    ioctlance_titles:
      - "buffer overflow"
      - "dest or src controllable"
    primitives: [pool_overflow, write_what_where]
    severity: critical

  use_after_free:
    autopiff_categories: [lifetime_fix]
    autopiff_sinks: [pool_free]
    ioctlance_titles: []
    primitives: [pool_overflow]
    severity: critical

  arbitrary_rw:
    autopiff_categories: [dma_mmio, mdl_handling, ioctl_hardening]
    autopiff_sinks: [mmio_dma, mdl_operations]
    ioctlance_titles:
      - "read/write controllable address"
      - "map physical memory"
    primitives: [direct_ioctl_rw, dma_mmio, mdl_mapping]
    severity: critical

  race_condition:
    autopiff_categories: [race_condition]
    autopiff_sinks: [synchronization, irp_cancel]
    ioctlance_titles: []
    primitives: [pool_overflow, write_what_where]
    severity: high

  type_confusion:
    autopiff_categories: [type_confusion]
    autopiff_sinks: [handle_validation]
    ioctlance_titles: []
    primitives: [write_what_where]
    severity: high

  integer_overflow:
    autopiff_categories: [int_overflow]
    autopiff_sinks: [pool_alloc, io_sanitization]
    ioctlance_titles: []
    primitives: [pool_overflow]
    severity: high

  null_deref:
    autopiff_categories: [pool_hardening]
    autopiff_sinks: [pool_alloc]
    ioctlance_titles:
      - "null pointer dereference - input buffer"
      - "null pointer dereference - allocated memory"
    primitives: []
    severity: medium

  info_disclosure:
    autopiff_categories: [info_disclosure]
    autopiff_sinks: [memory_zeroing, irp_completion]
    ioctlance_titles: []
    primitives: []
    severity: medium
    note: "KASLR bypass â€” enabler for other exploit chains"

  code_execution:
    autopiff_categories: []
    autopiff_sinks: []
    ioctlance_titles:
      - "arbitrary shellcode execution"
    primitives: [direct_code_exec]
    severity: critical

  privilege_escalation:
    autopiff_categories: [authorization, object_management]
    autopiff_sinks: [authorization, handle_validation, object_management]
    ioctlance_titles:
      - "controllable process handle"
      - "arbitrary process termination"
    primitives: [token_manipulation]
    severity: critical

  hw_access:
    autopiff_categories: [dma_mmio]
    autopiff_sinks: [mmio_dma]
    ioctlance_titles:
      - "arbitrary wrmsr"
      - "arbitrary out"
    primitives: [dma_mmio, direct_ioctl_rw]
    severity: critical

  file_registry_access:
    autopiff_categories: [filesystem_filter]
    autopiff_sinks: [filesystem_filter]
    ioctlance_titles:
      - "ObjectName in ObjectAttributes controllable"
    primitives: [registry_based]
    severity: high

  user_boundary:
    autopiff_categories: [user_boundary_check]
    autopiff_sinks: [user_probe, exceptions]
    ioctlance_titles: []
    primitives: [direct_ioctl_rw, write_what_where]
    severity: high

primitives:

  pool_overflow:
    description: "Pool corruption via buffer overflow enabling adjacent object corruption"
    techniques: [named_pipe_spray, io_ring, wnf_state_data, palette_bitmap]

  direct_ioctl_rw:
    description: "Direct arbitrary kernel read/write via IOCTL"
    techniques: [token_swap, pte_manipulation, previous_mode]

  dma_mmio:
    description: "Physical memory access via DMA/MMIO mapping"
    techniques: [token_swap, pte_manipulation]

  mdl_mapping:
    description: "Arbitrary kernel memory mapping via MDL abuse"
    techniques: [token_swap, pte_manipulation]

  write_what_where:
    description: "Controlled write of attacker value to attacker address"
    techniques: [token_swap, previous_mode, pte_manipulation]

  token_manipulation:
    description: "Direct token/privilege field overwrite"
    techniques: [token_swap]

  direct_code_exec:
    description: "Direct kernel code execution via controllable call target"
    techniques: []

  registry_based:
    description: "Arbitrary file/registry access via controllable path"
    techniques: []

techniques:

  io_ring:
    description: "I/O Ring structure corruption for kernel R/W"
    min_build: "10.0.22000"
    blocked_by: []

  token_swap:
    description: "Token pointer overwrite for privilege escalation"
    min_build: null
    blocked_by: []
    note: "Offsets change per build"

  pte_manipulation:
    description: "Page table entry modification for memory remapping"
    min_build: null
    blocked_by: []
    note: "Requires existing ARW primitive"

  previous_mode:
    description: "Thread PreviousMode flip to bypass access checks"
    min_build: null
    blocked_by: [hvci]

  named_pipe_spray:
    description: "Named pipe attribute spray for pool layout control"
    min_build: "10.0.17763"
    blocked_by: []

  wnf_state_data:
    description: "WNF state data corruption for relative R/W"
    min_build: "10.0.17763"
    max_build: "10.0.22000"
    blocked_by: [pool_hardening]

  palette_bitmap:
    description: "GDI palette/bitmap object abuse for kernel R/W"
    max_build: "10.0.17134"
    blocked_by: [type_isolation]
